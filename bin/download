#!/usr/bin/env bash

set -euo pipefail

current_script_path="${BASH_SOURCE[0]}"
plugin_dir="$(dirname "$(dirname "$current_script_path")")"

# shellcheck source=../lib/helpers.bash
source "${plugin_dir}/lib/helpers.bash"
# shellcheck source=../lib/utils.bash
source "${plugin_dir}/lib/utils.bash"

download() {
	local release_object
	local status_code
	release_object="$(construct_release_object "${ASDF_INSTALL_VERSION}" "$(get_os_name)")"

	log_info "‚è¨  downloading ${release_object}"
	status_code=$(curl -X GET \
		--write-out "%{http_code}" \
		--progress-bar \
		-Lo "${ASDF_DOWNLOAD_PATH}/${release_object}" \
		"https://github.com/oracle/oci-cli/releases/download/v${ASDF_INSTALL_VERSION}/${release_object}")
		#"https://storage.googleapis.com/storage/v1/b/${gcs_bucket_name}/o/${gcs_object}?alt=media")

	if [[ ${status_code} -eq 404 ]]; then
		log_failure_and_exit "oci not found for version ${ASDF_INSTALL_VERSION}. Full version required, not just major version numbers."
	fi
	log_success "downloaded!"
}

download
